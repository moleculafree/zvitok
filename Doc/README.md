> [!IMPORTANT]  
> Проект розповсюджується безкоштовно.  Якщо Ви бажаєте підтримати його розвиток, посилання [для донатів](https://send.monobank.ua/2MXeqRNEPw)
  

### Що вміє ZvitOkPlus ###

Все те що і звичайний ZvitOk 16.10.2023, плюс:
1. Оновлені функції роботи з ключами і сертифікатами.
2. Корректна робота з сертифікатами що видані після 2023 року.
3. Додана підтримка ключів "Вчасно Сервіс" та monobank.
4. Автоматичне визначення КНЕДП при додавані Підпису. [КНЕДП](#Автоматичне-визначення-КНЕДП)
5. Якщо в сертифікаті користувача бракує інформації, вона зчитується з [INI файла](#Додавання-даних-в-Профіль-ЕЦП-за-відсутності-їх-в-сертифікаті)
6. Під час імпорту звітів, встановлення прапорця головного звіту автоматично позначає прапорці пакетних звітів.
7. Об'єднаний фільтр .dat,.pfx при додавані ключів в профілі организації.
8. Підтримка актуальності даних підпису - зчитування інформацію про Підпис з сертифікату, а не з ключа.
9. Перевірка терміну дії Підпису враховує Дату та Час.
10. Можливість самостійно керувати списком КНЕДП шляхом оновлення файлу \Certificates\CAs.json [CAs](#Завантаження-списку-КНЕДП-з-файлу)
11. Магічна кнопка [Відновити систему](#Відновлення-стану-системних-файлів)
12. ZvitOkPlus використовує новий формат збереження даних, тому якщо ви запустите старий ZvitOk, ви не побачите внесені зміни<sup>але є нюанс</sup>
13. Можливість блокування файлу CACertificates.p7b від змін.
14. Можливість видаляти відправлені звіти без квитанцій.
15. Можливість вимкнення підказок у списку звітів.
16. Можливіть вибору відображенням короткої або повної назви форми звітів.
17. Можливіть використання окремих шаблонів розмітки звітів для формування PDF файлів [XSLT-файли](#XSLT-файли).
18. Можливіть скопіювати список Термін дії ЕЦП з Налаштування параметрів програми Альтернативна назва файлу квитанцій
19. Можливість формування альтернативної назва файлу квитанцій [Файли квитанцій](#Файли-квитанцій).
20. Можливіть запускати кілька копій програми.
21. Автоматично зберігає стан опцій та шляхи вибору ключів/підписів.
22. Можливість вести лог файл роботи програми [Debug](#Debug)

### Експорт списків ###
> [!NOTE]  
> доступно, починаючи з версії 14.

Щоб скопіювати дані зі списку «Термін дії ЕЦП», натисніть праву кнопку миші та виберіть пункт «Копіювати в буфер обміну».
Якщо ви попередньо виділили рядки — буде скопійовано лише їх, інакше скопіюється весь список.


### Перевірка терміну дії ЕЦП ###

Перевірка терміну дії ЕЦП тепер враховує дату та час **із сертифіката** (не ключа).
Для коректної роботи необхідно оновити ключі в профілі організації.
Оновлені дані відображатимуть термін дії у форматі «Дата Час», неоновлені — лише «Дата».


### Видаляти відправлені звіти без квитанцій ###

Програма дає змогу видаляти звіти зі статусом "**Надісланий**", за якими після відправлення немає квитанцій (наприклад, протягом 3 днів).  
Для цього в налаштуваннях потрібно ввімкнути прапорець «Видаляти надіслані звіти без квитанцій».  
Увімкніть цю опцію лише якщо впевнені, що вона вам потрібна та розумієте можливі наслідки.


### Завантаження списку КНЕДП з файлу ###

Якщо вам потрібно оновити список "прямо зараз", ви можете завантажити актуальні налаштування сумісних КНЕДП з сайту [Центральний засвідчувальний орган](https://czo.gov.ua/certificates) і розмістити/перезаписати його в папці ZvitOK\Certificates\CAs.json.

### Автоматичне визначення КНЕДП ###

При додавані підпису, в списку «КНЕДП, що видав сертифікати» доступний варіант «Автоматичне визначення». 
Обравши його, програма спробує самостійно знайти КНЕДП і завантажити сертифікат. 
Майте на увазі: автоматичний пошук може бути повільнішим за ручний. 
Увімкнення в налаштуваннях прапорця «Оптимізувати список КНЕДП для автоматичного визначення» допоможе пришвидшити пошук.  

### Відновлення стану системних файлів ###

Якщо ви завантажили невдалий файл сертифікатів або список КНЕДП чи після редагування custom.ini програма перестала розуміти вас, зайдіть в Налаштування і натисніть кнопку **Відновити систему**. Після цього перезавантажте програму.

Ця процедура повертає початковий стан програми до "нове встановлення":
- видаляє файл \Data\custom.ini  
- видаляє файл \Certificates\Cas.json  
- перезаписує файл \Certificates\CACertificates.p7b  

Файли бази даних профілів не змінюються.

### Файл Data\System\default.ini ###

Файл містить початковий перелік налаштувань які враховуються при роботі і для яких непотрібно змінювати код програми.  
**Цей файл оновлюється при кожній новій версії програми. Не змінюйте цей файл. Для власних налаштувань використовуйте файл \Data\custom.ini**

### Файл Data\custom.ini ###

Це пріоритетний файл власних перевизначених налаштувань користувача. 
Фактично це копія default.ini але з вашими налаштуваннями та поточним станом елементів програми.
Ви можете змінювати цей файл на ваш розсуд. При інсталяції нових оновлень цей файл не змінюється.  
Програма буде считувати налаштування спочатку з файлу \Data\custom.ini, а потім з \Data\System\default.ini.  
**Важливо! Не впевнені у діях — не змінюйте цей файл.**  
Файл повинен мати ANSI кодування.

#### Перевизначення номерів службових сертифікатів ####
(номера сертифікатів вказувати у верхньому регістрі)
```
[DFS]
isuer=O=Державна податкова служба України;CN=КНЕДП ДПС;Serial=UA-43005393-0522;C=UA;L=Київ
serial=3FAA9288358EC00304000000995A2C005DDFE600

[DSS]
isuer=O=ТОВ "Центр сертифікації ключів "Україна";CN=КНЕДП ТОВ "Центр сертифікації ключів "Україна";Serial=UA-36865753-2101;C=UA;L=Київ
serial=2DB6710700000000000000000000000000000001
```

#### Додавання даних в Профіль ЕЦП за відсутності їх в сертифікаті ####
> [!IMPORTANT]  
> в Налаштуваннях програми має бути увімкнено прапорець "Підтягувати відсутні дані в профіль з INI файлу"

##### Назва секції ##### 
[acsk-url] - де, acsk_url це адреса КНЕДП (у назві замість крапок використовується дефіс), що видав сертифікат, наприклад ca-monobank-ua  
або  
[acsk-url-1234567890]  де, 1234567890 код ЄДРПОУ фізичної особи  

Якщо не знайдено дані в секції [acsk-url-1234567890] буде проведено пошук в секції [acsk-url]

##### Назви опцій #####

**pszSubjTitle**
Посада власника сертифіката, текстовий рядок, наприклад: ФІЗИЧНА ОСОБА, Директор, Бухгалтер, ...

**pszSubjOrg**
Організація до якої належить, власник сертифіката, текстовий рядок, наприклад: ФІЗИЧНА ОСОБА, БСПНГУ "АЗОВ", ...

**pszExtKeyUsages**
Уточнене призначення ключів, текстовий рядок, наприклад: печатка, електронна печатка

До назви опції застосовується суфікс _sign що визначае тип Підпису:
* _sign0 -  підпис керівника
* _sign1 - Печатка
* _sign2 - підпис бухгалтера


Приклад для monobank:
```
[ca-monobank-ua]

pszSubjTitle_sign0=ФІЗИЧНА ОСОБА
pszSubjOrg_sign0=ФІЗИЧНА ОСОБА
pszExtKeyUsages_sign1=печатка

[ca-monobank-ua-1234567890]
pszSubjTitle_sign2=Бухгалтер

```


### Файли квітанцій ###

Якщо в Налаштуваннях увімкнено опцію «Альтернативна назва файлу квитанцій», то назва файлу формуватиметься з назви файлу звіту та номера квитанції. В іншому випадку для назви файлу використовується номер форми квитанції.

### XSLT-файли ###
> [!IMPORTANT]
> файл XML - це дані  
> файл XSLT -  це шаблон/стилі оформлення  
> файл FO - це результат об'єднання даних з шаблоном для подальшої трансформації в кінцевий формат (PDF, HTML, ...)  
> повний ланцющок перетворення: XML + XSLT → FO  

Тека завантаження шаблонів \Data\Templates\  

Для створення PDF-файлів друку звітів використовуються файли розмітки формату .FO (насправді це XSLT).  
Наприклад, щоб згенерувати PDF звіту «F0510410 — Відомості про суми нарахованого доходу, утриманого та сплаченого податку на доходи фізичних осіб та військового збору», необхідний файл розмітки F0510410.fo.  
Оскільки Державна податкова служба регулярно оновлює форми звітност, потрібно оновлювати файли розмітки .fo. Не завжди є доцільним або можливим випускати нову версію програми лише заради додавання актуальних форм розмітки.  
Тому в програмі передбачена зручна функція: користувач може самостійно завантажувати та підключати потрібні файли розмітки форм .fo за необхідності.  

Назва файлу повина відовідати назві форми звіту: 
* Форма F0510410 - файл F0510410.fo
* Форма F0510110 - файл F0510110.fo
* Форма J1499202 - файл J1499202.fo


Де взяти файл?
1. Використати пошук в мережі Інтернет та завантажити вже готовий файл.
2. Переглянути Реєстр форм електронних документів і спробувати створити потрібний .fo
файл.
3. Звернутись до технічного письменника з навичками форматування XSL-FO документів.
4. Попередній пунк доволі дієвий.
5. Вибрати свій шлях.


### Debug ###
> [!NOTE]
> лише частина функцій має режим debug  
> доступно, починаючи з версії 15.

Журнал роботи програми можна ввімкнути лише через файл. **Закрийте програму до внесення змін у файл.**  
Після активації режиму DebugLog і запуску програми буде створено файл debug-<поточна дата>.log . Дані з файлу можна використати для відстеження помилок в роботі.  
Режим DebugLog автоматично вимикається (видаляеться рядок з файлу) після завершення роботи програми. 

Приклад активації DebugLog:  
Додайте в файлі \Data\custom.ini в розділ [General] наступний рядок
```
DebugLog=1
```

